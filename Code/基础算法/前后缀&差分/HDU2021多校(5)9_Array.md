# ğŸ”—
<a href="https://acm.dingbacode.com/showproblem.php?pid=7020"><img src="https://img-blog.csdnimg.cn/f79012f522be4ae3beaac838fe1de587.png"></a>

# ğŸ’¡
ä¸[LuoguP4062 Yazid çš„æ–°ç”Ÿèˆä¼š](https://www.luogu.com.cn/problem/P4062)ä¸€æ ·ï¼Œæ˜¯æ±‚å«æœ‰ç»å¯¹ä¼—æ•°çš„åŒºé—´ä¸ªæ•°ï¼Œä½†æ˜¯æ•°æ®é‡æ˜¯1e6æ‰€ä»¥æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªlogï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ª
logå°±å¾ˆéš¾åšåˆ°å¾ˆå¤šåˆ†æ²»ç±»åšæ³•  
  
å¯¹äºä¸€ä¸ªæ•°xï¼Œå¯¹äºç¬¬iä¸ªä½ç½®ï¼Œå¦‚æœå½“å‰ä½ç½®æ˜¯xé‚£ä¹ˆå°±å¯ä»¥è®¾ç½®ä¸º1ï¼Œå¦åˆ™æ˜¯-1  
é‚£ä¹ˆå¯¹è¿™ä¸ªå€¼æ±‚ä¸€ä¸‹å‰ç¼€å’Œsumï¼Œå¦‚æœå¯¹äºä¸€ä¸ªä½ç½®sum[i]-sum[j]>0ï¼Œè¯´æ˜è¿™æ®µåŒºé—´å†…è¿™ä¸ªæ•°å‡ºç°ä¸ªæ•°æ¯”åˆ«çš„æ‰€æœ‰æ•°å‡ºç°ä¸ªæ•°è¦å¤š  
é‚£ä¹ˆé—®é¢˜å°±è½¬åŒ–ä¸ºï¼Œå¯¹äºæ¯ä¸ªæ•°xï¼Œå»ºç«‹å®Œsumæ•°ç»„ä¹‹åï¼Œæ±‚æ¯ä¸€ä¸ªä½ç½®å‰é¢sum[j] < sum[i]çš„ä¸ªæ•°  
  
å¯ä»¥ç»´æŠ¤ä¸€ä¸ªf1æ•°ç»„ç”¨æ¥ç»´æŠ¤æ¯ä¸€ä¸ªsumçš„ä¸ªæ•°ï¼Œf2æ•°ç»„æ˜¯ç”¨æ¥å¯¹f1è¿›è¡ŒåŒºé—´ä¿®æ”¹çš„å·®åˆ†æ•°ç»„  
åœ¨å½“å‰è¿™ä¸€æ®µä¸€ç›´å‡ºç°xæˆ–è€…æœªåˆ°æœ€å°å€¼ï¼Œå¯ä»¥ç›´æ¥çº¿æ€§æ±‚è§£ï¼ŒSUMä¸æ–­ç´¯åŠ sum[ä¸ªæ•°]    
å¦‚æœåˆ°äº†æœ€å°å€¼å¹¶ä¸”è¿˜æ˜¯æ²¡æœ‰å‡ºç°xï¼Œæ„å‘³ç€ä¸€ç›´ä¸‹å‡ï¼Œå‰é¢ä¸€å®šä¸ä¼šå‡ºç°è§£  
é‚£ä¹ˆå°±å¯ä»¥è·³è¿‡è¿™ä¸€æ®µï¼Œé‡Œé¢çš„è¦æ”¹çš„æ•°å¯ä»¥é€šè¿‡åŒºé—´ä¿®æ”¹ä¸€èµ·æ”¹äº†ï¼ŒåŒæ—¶SUMé‡ç½®ä¸º0  


# <img src="https://img-blog.csdnimg.cn/20210713144601841.png" >
```cpp
#include <iostream>
#include <map>
#include <vector>
#include <cstring>
#include <algorithm>
#include <unordered_map>

#define ll long long
using namespace std;


const int N = 2e6 + 10;

map<int, vector<int> > g;

int n, cass, a[N]; 
ll res = 0;

inline void Solve ( int x ) {
        g[x].push_back(n + 1);
        unordered_map<ll, ll> f1, f2;
        f1[0] = 1; ll sum = 0/*å‰é¢å¤šå°‘ä¸ªæ¯”å½“å‰å‰ç¼€å’Œå°çš„*/, tmp = 0/*å½“å‰å‰ç¼€å’Œ*/, minn = 0/*å‰é¢å‡ºç°è¿‡çš„æœ€å°å‰ç¼€å’Œ*/;
        for ( int i = 1, j = 0; i <= n; i ++ ) {
                if ( i > g[x][j] ) j ++; // ä¿æŒg[x][j]ä¸€ç›´ >= i
                if ( a[i] == x ) {
                        tmp ++; 
                        f1[tmp] += f2[tmp] + 1; // åˆ©ç”¨å·®åˆ†çš„f2è®©f1å¾€å‰èµ°ä¸€æ­¥
                        f2[tmp + 1] += f2[tmp]; f2[tmp] = 0;
                        sum += f1[tmp - 1]; // åˆå¤šäº†ä¸€ä¸ªæ¯”tmpå°çš„
                        res += sum;
                } else if ( tmp - 1 <= minn ) { // è¿™ä¸ªåŒºé—´è·³è¿‡
                        int len = g[x][j] - i; // è·³è¿‡åŒºé—´çš„æ¯ä¸ªsumçš„ä¸ªæ•° ++
                        ++ f2[tmp - len + 1]; -- f2[tmp]; // åŒºé—´ä¿®æ”¹
                        ++ f1[tmp - len];
                        tmp -= len;
                        i = g[x][j] - 1;
                        sum = 0; // æœ€å°çš„ï¼Œå‰é¢æ²¡æœ‰æ›´å°çš„äº†ï¼Œæ‰€ä»¥sumæ¸…0
                } else {
                        sum -= f1[-- tmp]; // å°±æ˜¯å…‰å‡è€Œå·²ï¼Œä¹Ÿæ²¡å¤šä»€ä¹ˆï¼Œå°±åˆ©ç”¨å·²æœ‰çš„f1è®¡ç®—å³å¯
                        res += sum;
                        ++ f1[tmp];
                }
                if ( tmp < minn ) minn = tmp; // æœ€å°å€¼ç»´æŠ¤ä¸€ä¸‹
        }
}

int main () {
        ios::sync_with_stdio(false);
        for ( cin >> cass; cass; cass -- ) {
                cin >> n;
                for ( int i = 1; i <= n; i ++ ) {
                        cin >> a[i];
                        g[a[i]].push_back(i); // å¯¹æ¯ä¸ªå­˜ä¸€ä¸‹ä½ç½®
                }
                res = 0;
                for ( auto v : g ) { // åˆ†å¼€è§£å†³
                        Solve(v.first);
                        g[v.first].clear(); // åœ¨æ±‚å®Œå°±å¯ä»¥åˆ æ‰äº†
                }
                cout << res << endl;
        }
}

```
